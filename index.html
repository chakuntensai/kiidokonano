<script>
  const keyMap = {
    // 記号キー（省略せずそのまま残す）
    "！": { key: "1", shift: true },
    "？": { key: "/", shift: true },
    "、": { key: "ね", shift: false },
    "。": { key: "る", shift: false },
    "「": { key: "れ", shift: false },
    "」": { key: "け", shift: false },
    "＠": { key: "2", shift: true },
    "＃": { key: "3", shift: true },
    "＄": { key: "4", shift: true },
    "％": { key: "5", shift: true },
    "＾": { key: "6", shift: true },
    "＆": { key: "7", shift: true },
    "＊": { key: "8", shift: true },
    "（": { key: "9", shift: true },
    "）": { key: "0", shift: true },
    "”": { key: "2", shift: true },
    '"': { key: "2", shift: true },
    "'": { key: "7", shift: false },
    "ー": { key: "-", shift: false },
    "＝": { key: "ほ", shift: false },
    "＋": { key: "ほ", shift: true },
    "〜": { key: "へ", shift: true },
    ":": { key: "れ", shift: true },
    "；": { key: "れ", shift: false },
    "_": { key: "ろ", shift: true },
    "\\": { key: "む", shift: false },
    "|": { key: "む", shift: true },
    "[": { key: "「", shift: false },
    "]": { key: "」", shift: false },
    "{": { key: "「", shift: true },
    "}": { key: "」", shift: true },
    "<": { key: "ね", shift: true },
    ">": { key: "め", shift: true },
    "￥": { key: "む", shift: false },
    "・": { key: "め", shift: false },

    // 機能キー（英語名も対応）
    "home": { key: "←", fn: true },
    "end": { key: "→", fn: true },
    "pageup": { key: "↑", fn: true },
    "pagedown": { key: "↓", fn: true },
    "insert": { key: "ろ", fn: true },
    "delete": { key: "Backspace", fn: true },
    "capslock": { key: "Caps Lock", fn: false },
    "無変換": { key: "無変換", fn: false },
    "変換": { key: "変換", fn: false },
    "半角/全角": { key: "半角/全角", fn: false },
  };

  // 特殊ケース（キーに直接対応しない便利機能）
  const specialMap = {
    "emoji": true,
    "絵文字": true,
    "えもじ": true
  };

  function normalizeInput(str) {
    return str
      .toLowerCase()
      .replace(/\s+/g, "")
      .replace(/[Ａ-Ｚａ-ｚ０-９]/g, s =>
        String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
      );
  }

  const searchInput = document.getElementById("search");
  const result = document.getElementById("result");

  searchInput.addEventListener("input", () => {
    const inputValue = searchInput.value.trim();
    const normalized = normalizeInput(inputValue);

    // 絵文字機能対応
    if (specialMap[normalized]) {
      result.innerHTML = `
        <div class="key-info">
          🎉 <strong>絵文字</strong>は <span class="key">Windows</span> + <span class="key">.</span> で呼び出せます！
        </div>
      `;
      return;
    }

    if (normalized in keyMap) {
      const info = keyMap[normalized];
      const parts = [];

      if (info.shift) parts.push('<span class="key shift">Shift</span>');
      if (info.fn) parts.push('<span class="key fn">Fn</span>');
      parts.push(`<span class="key">${info.key}</span>`);

      result.innerHTML = `
        <div class="key-info">「${inputValue}」は ${parts.join(" + ")} のキーにあります。</div>
      `;
    } else {
      result.innerHTML = "<div class='key-info'>そのキーはまだ登録されていません。</div>";
    }
  });
</script>
